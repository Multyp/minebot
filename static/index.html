<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MineBot Locations</title>
  <meta name="description" content="Minecraft world locations viewer" />
  <!-- Tailwind CSS (CDN build) -->
  <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
  <!-- Flowbite -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.css" integrity="sha512-jYrM7AqJkqTsYwFqzu8G3Yjwro8VV1mAT8Q0xujvHI5em/UkJ048UErmc09Nb4OwHFxuRRJpLbRwYs4r0u3rYg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.js" integrity="sha512-y8TV3tU4B/QBFtmYglAxFZlSLlG+hnlqpY8LOVqnO+uLkP4KAdT4mUERmLCcuoI6JYcE5lOksW+wHeWUqCrjyw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <link rel="icon" type="image/png" href="https://static.wikia.nocookie.net/minecraft_gamepedia/images/3/32/Grass_Block.png" />
  <style>
    body { 
      background: url('./mc-background.png') repeat; 
      image-rendering: pixelated;
    }
    .panel {
      background: rgba(18, 24, 16, 0.85);
      backdrop-filter: blur(4px);
      box-shadow: 0 0 0 2px #3f6212, 0 0 12px #000 inset;
    }
    .mc-font {
      font-family: 'Minecraftia', 'Press Start 2P', ui-monospace, monospace;
      letter-spacing: 0.5px;
    }
  </style>
</head>
<body class="h-full text-gray-100">
  <header class="panel mx-auto max-w-5xl mt-6 rounded-lg border border-lime-600 p-4 flex items-center gap-4">
    <img src="https://static.wikia.nocookie.net/minecraft_gamepedia/images/3/32/Grass_Block.png" alt="Logo" class="w-10 h-10" />
    <div>
      <h1 class="text-2xl font-bold mc-font text-lime-400 drop-shadow">MineBot Locations</h1>
      <p class="text-sm text-lime-200/70">Tracking structures & farms — click to copy /tp command.</p>
    </div>
    <div class="ml-auto flex gap-2">
      <button id="refreshBtn" class="px-3 py-2 text-sm rounded bg-lime-600 hover:bg-lime-500 focus:ring-2 focus:ring-lime-400">Refresh</button>
      <button id="toggleViewBtn" class="px-3 py-2 text-sm rounded bg-emerald-600 hover:bg-emerald-500 focus:ring-2 focus:ring-emerald-400">Grid</button>
    </div>
  </header>

  <main class="mx-auto max-w-5xl mt-6 space-y-6 pb-16">
    <section id="stats" class="panel rounded-lg border border-lime-700 p-4 grid grid-cols-2 sm:grid-cols-4 gap-4 text-center"></section>

    <section class="panel rounded-lg border border-lime-700 p-4">
      <div class="flex items-center mb-4 gap-3 flex-wrap">
        <h2 class="text-xl font-semibold mc-font text-lime-300">Locations</h2>
        <input id="search" type="text" placeholder="Search..." class="flex-1 min-w-[180px] bg-gray-900/70 border border-lime-700 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-lime-500" />
        <select id="statusFilter" class="bg-gray-900/70 border border-lime-700 rounded px-3 py-2 text-sm">
          <option value="all">All</option>
          <option value="available">Available</option>
          <option value="looted">Looted</option>
        </select>
      </div>
      <div id="locationsContainer" class="space-y-3"></div>
    </section>
  </main>

  <template id="locationTemplate">
    <div class="location block rounded border border-lime-800 bg-gradient-to-br from-gray-900/90 to-gray-800/70 hover:border-lime-500 transition shadow-sm">
      <button class="w-full text-left p-4 flex items-start gap-4 group">
        <div class="flex flex-col items-center w-12 shrink-0 mt-1">
          <span class="emoji text-2xl">💎</span>
          <span class="mt-1 px-1.5 py-0.5 rounded text-[10px] font-semibold statusBadge">NEW</span>
        </div>
        <div class="flex-1 min-w-0">
          <h3 class="name font-bold mc-font text-lime-300 group-hover:text-lime-200"></h3>
          <div class="instances text-xs text-lime-200/80 mt-1"></div>
          <div class="coords text-sm font-mono mt-2 grid gap-1"></div>
        </div>
        <div class="opacity-0 group-hover:opacity-100 transition text-xs text-lime-300">Click to copy</div>
      </button>
    </div>
  </template>

  <script>
  // Using a relative path that works after we publish "static" + "data" contents to the site root on GitHub Pages.
  // The workflow will copy: static/* -> dist/ (root) and data/ -> dist/data/
  // So the file will live at ./data/locations.json next to index.html.
  const DATA_URL = './data/locations.json';

    const state = { raw: {}, view: 'list' };

    const el = id => document.getElementById(id);
    const statsEl = el('stats');
    const container = el('locationsContainer');
    const template = document.getElementById('locationTemplate');

    function normalizeName(key) {
      return key.replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
    }

    function formatCoords(arr) { return arr.join(', '); }

    function buildStats(data) {
      let totalTypes = Object.keys(data).length;
      let totalInstances = 0; let looted = 0; let available = 0;
      for (const list of Object.values(data)) {
        totalInstances += list.length;
        for (const inst of list) { inst.looted ? looted++ : available++; }
      }
      statsEl.innerHTML = [
        { label: 'Types', value: totalTypes },
        { label: 'Instances', value: totalInstances },
        { label: 'Available', value: available },
        { label: 'Looted', value: looted }
      ].map(s => `<div class='p-3 rounded bg-gray-900/60 border border-lime-800'><div class='text-2xl font-bold text-lime-300 mc-font'>${s.value}</div><div class='mt-1 text-[11px] tracking-wide uppercase text-lime-400/70'>${s.label}</div></div>`).join('');
    }

    function render() {
      const q = el('search').value.toLowerCase().trim();
      const filter = el('statusFilter').value;
      container.innerHTML = '';

      const keys = Object.keys(state.raw).sort();
      for (const key of keys) {
        const instances = state.raw[key];
        if (q && !key.includes(q)) continue;
        const anyMatchesStatus = instances.some(i => filter === 'all' || (filter === 'available' && !i.looted) || (filter === 'looted' && i.looted));
        if (!anyMatchesStatus) continue;

        const clone = template.content.firstElementChild.cloneNode(true);
        clone.querySelector('.name').textContent = normalizeName(key);
        clone.querySelector('.instances').textContent = `${instances.length} instance${instances.length!==1?'s':''}`;

        const coordsDiv = clone.querySelector('.coords');
        coordsDiv.classList.toggle('grid-cols-2', state.view === 'grid');

        const filteredInstances = instances.filter(i => filter === 'all' || (filter === 'available' && !i.looted) || (filter === 'looted' && i.looted));
        for (const inst of filteredInstances) {
          const btn = document.createElement('div');
          btn.className = `px-2 py-1 rounded border text-[11px] flex justify-between items-center gap-2 ${inst.looted ? 'border-amber-600 bg-amber-900/40 text-amber-300' : 'border-lime-700 bg-lime-900/40 text-lime-300'} hover:brightness-110 cursor-pointer`;
          btn.textContent = formatCoords(inst.coords);
          btn.title = inst.looted ? 'Looted' : 'Available';
          btn.addEventListener('click', e => {
            e.stopPropagation();
            copyTp(inst.coords);
          });
          coordsDiv.appendChild(btn);
        }

        const statusBadge = clone.querySelector('.statusBadge');
        const availableCount = instances.filter(i=>!i.looted).length;
        if (availableCount === 0) {
          statusBadge.textContent = 'LOOTED';
          statusBadge.className = 'statusBadge px-1.5 py-0.5 rounded text-[10px] font-semibold bg-amber-800/60 border border-amber-600 text-amber-300';
          clone.querySelector('.emoji').textContent = '🏴‍☠️';
        } else if (availableCount === instances.length) {
          statusBadge.textContent = 'NEW';
          statusBadge.className = 'statusBadge px-1.5 py-0.5 rounded text-[10px] font-semibold bg-lime-800/60 border border-lime-600 text-lime-300';
          clone.querySelector('.emoji').textContent = '💎';
        } else {
          statusBadge.textContent = 'MIXED';
          statusBadge.className = 'statusBadge px-1.5 py-0.5 rounded text-[10px] font-semibold bg-emerald-800/60 border border-emerald-600 text-emerald-300';
          clone.querySelector('.emoji').textContent = '⛏️';
        }

        clone.querySelector('button').addEventListener('click', () => {
          // Copy all available coords first, else first instance
            const availableInst = instances.filter(i=>!i.looted);
            const list = (availableInst.length?availableInst:instances).map(i=>`/tp ${i.coords.join(' ')}`).join('\n');
            navigator.clipboard.writeText(list).then(()=>toast(`${availableInst.length?availableInst.length:instances.length} teleport command(s) copied`));
        });

        container.appendChild(clone);
      }

      if (!container.children.length) {
        container.innerHTML = `<div class='p-6 text-center text-sm text-lime-300/70 border border-lime-800 rounded bg-gray-900/60'>No locations match your filters.</div>`;
      }
    }

    function copyTp(coords) {
      const cmd = `/tp ${coords.join(' ')}`;
      navigator.clipboard.writeText(cmd).then(()=>toast('Teleport command copied'));
    }

    function toast(msg) {
      let t = document.createElement('div');
      t.className = 'fixed bottom-4 left-1/2 -translate-x-1/2 bg-gray-900/90 border border-lime-600 text-lime-200 px-4 py-2 rounded shadow-lg text-sm animate-fade';
      t.textContent = msg;
      document.body.appendChild(t);
      setTimeout(()=>{t.classList.add('opacity-0'); setTimeout(()=>t.remove(), 400);}, 1800);
    }

    function setView(view) {
      state.view = view;
      render();
    }

    async function load() {
      try {
        const res = await fetch(DATA_URL + '?_=' + Date.now());
        if (!res.ok) throw new Error(res.status + ' ' + res.statusText);
        state.raw = await res.json();
        buildStats(state.raw);
        render();
      } catch (e) {
        container.innerHTML = `<div class='p-6 text-center text-sm text-red-300 border border-red-800 rounded bg-red-900/40'>Failed to load: ${e.message}</div>`;
      }
    }

    el('search').addEventListener('input', render);
    el('statusFilter').addEventListener('change', render);
    el('refreshBtn').addEventListener('click', load);
    el('toggleViewBtn').addEventListener('click', () => {
      state.view = state.view === 'list' ? 'grid' : 'list';
      el('toggleViewBtn').textContent = state.view === 'list' ? 'Grid' : 'List';
      document.getElementById('locationsContainer').classList.toggle('grid', state.view === 'grid');
      document.getElementById('locationsContainer').classList.toggle('gap-3', state.view === 'grid');
      document.getElementById('locationsContainer').classList.toggle('grid-cols-1', state.view === 'grid');
      render();
    });

    load();
  </script>
</body>
</html>
